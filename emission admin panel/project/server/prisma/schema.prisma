generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Admin {
  id       String @id @default(uuid())
  email    String @unique
  password String
  name     String
  role     String @default("admin")
}

model Product {
  id               String   @id @default(uuid())
  name             String
  slug             String   @unique
  category         String
  subcategory      String
  description      String
  shortDescription String
  price            Decimal
  wholesalePrice   Decimal
  retailPrice      Decimal?
  images           String   @default("[]")
  features         String   @default("[]")
  specifications   String   @default("{}")
  inStock          Boolean  @default(true)
  moq              Int      @default(1)
  availableSizes   String   @default("[]")
  availableColors  String   @default("[]")
  allowsEmbroidery Boolean  @default(false)
  gstPercentage    Decimal  @default(18)
  shippingIncluded Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  variants         ProductVariant[]
  embroideryOptions EmbroideryOption[]
}

model ProductVariant {
  id              String   @id @default(uuid())
  productId       String
  product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  size            String
  color           String
  sku             String   @unique
  stock           Int      @default(0)
  priceAdjustment Decimal  @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@unique([productId, size, color])
}

model EmbroideryOption {
  id        String   @id @default(uuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  position  String
  maxChars  Int      @default(20)
  price     Decimal
  available Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Enquiry {
  id          String   @id @default(uuid())
  name        String
  email       String
  phone       String
  company     String?
  enquiryType String
  message     String
  status      String   @default("new")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Order {
  id              String   @id @default(uuid())
  customerName    String
  customerEmail   String
  customerPhone   String?
  totalAmount     Decimal
  status          String   @default("pending")
  paymentId       String?
  shippingAddress String
  items           String
  trackingId      String?
  courierId       String?
  invoiceId       String?
  taxAmount       Decimal? @default(0)
  source          String   @default("website") // website, pos
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Courier {
  id        String   @id @default(uuid())
  name      String
  api_key   String?
  apiUrl    String?
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Setting {
  key   String @id
  value String
}

model Banner {
  id        String   @id @default(uuid())
  title     String?
  subtitle  String?
  imageUrl  String
  link      String?  @default("/products")
  active    Boolean  @default(true)
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model FeaturedCollection {
  id          String   @id @default(uuid())
  title       String
  description String?
  imageUrl    String
  link        String?
  active      Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model InvoiceTemplate {
  id              String   @id @default("default-template")
  companyName    String   @default("EMISSION")
  companyAddress String   @default("Jabalpur, Madhya Pradesh")
  companyPhone   String   @default("+91 0000000000")
  companyEmail   String   @default("support@emission.in")
  companyLogo    String?
  gstNumber      String?
  terms          String   @default("Thank you for choosing EMISSION. We appreciate your business!")
  primaryColor   String   @default("#1a1a1a")
  accentColor    String   @default("#3b82f6")
  updatedAt      DateTime @updatedAt
}

model Coupon {
  id              String   @id @default(uuid())
  code            String   @unique
  discountType    String   // percentage, fixed
  discountValue   Decimal
  minOrderAmount  Decimal  @default(0)
  maxDiscount     Decimal?
  expiryDate      DateTime?
  usageLimit      Int      @default(0) // 0 for unlimited
  usedCount       Int      @default(0)
  active          Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
